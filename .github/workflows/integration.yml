name: Octopus-merge to testing
on: workflow_dispatch
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
        with:
          fetch-depth: '0'

      - name: Get branch names by labels
        id: branch_names
        uses: festinuz/octupus-merge@master
        with:
          github_token: ${{ github.token }}
          labels: test

      - name: Push changes to test branch
        run: |
          git config --global user.email "noreply@github.com"
          git config --global user.name "octomerger"
          echo "${{ steps.branch_names.outputs.branches }}"
          git checkout testing
          git reset --hard master --
          git merge --squash ${{ steps.selftest.branch_names.branches }} && git commit -m "Merge branches found by labels"
          git push origin HEAD --force
